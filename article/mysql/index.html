<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="viewport"
    content="width=device-width, initial-scale=1, user-scalable=no">
<link rel="stylesheet" href="../../stylesheets/styles.css">
<link rel="stylesheet" href="../../stylesheets/font-awesome.min.css">
<link rel="stylesheet" href="../../stylesheets/pygment_trac.css">
<title>Mysql</title>
</head>
<body data-spy="scroll" data-target="#leftNav">
    <div class="right-corner-nav">
  <a href="../../index.html" class="notebook">
    <i class="icon-home"></i> 
</a></div>
    
    <a href="javascript:void(0);" class="show-contents">
      <i class="icon-chevron-right"></i>
    </a>
    
    <div id="leftNav" class="leftpanel contents contents-active">
        <div class="close"><i class="icon-remove"></i></div>
        
        <h1>Mysql</h1>
        <ul class="unstyled nav">
          <li class="show-note-link">
          <a href="#basic">Mysql Basic<i class="icon-chevron-right"></i></a>
          </li>
          <li class="show-note-link">
          <a href="#sql">SQL、Data Types<i class="icon-chevron-right"></i></a>
          </li>
          
      </ul>
    </div>
    <div class="posts">
      <article id="basic">
      	<h1>MYSQL BASIC</h1>

<p><img src="mysql.png" alt="" title="" /></p>

<h2>概述</h2>

<blockquote>
  <ul>
  <li>MySQL是一种关联数据库管理系统---关联数据库将数据保存在不同的表中，而不是将所有数据放在一个大的仓库内。这样就增加了速度并提高了灵活性。  </li>
  <li>MySQL软件是一种开放源码软件。  </li>
  <li>MySQL数据库服务器具有快速、可靠和易于使用的特点。  </li>
  <li>MySQL服务器工作在客户端/服务器模式下，或嵌入式系统中。  </li>
  <li>有大量可用的共享MySQL软件。  </li>
  </ul>
</blockquote>

<p><strong>“MySQL”的正式发音是“My Ess Que Ell”（而不是“my sequel”）,但我们并不介意你的发音方式是“my sequel”或其他当地方式。</strong></p>

<h4>MySQL的的主要特性</h4>

<ul>
<li>使用C和C++编写</li>
<li>能够工作在众多不同的平台上</li>
<li>提供了用于C、C++、Eiffel、Java、Perl、PHP、Python、Ruby和Tcl的API</li>
<li>采用核心线程的完全多线程 如果有多个CPU，它能方便地使用这些CPU。</li>
<li>提供了事务性和非事务性存储引擎。</li>
<li>使用了极快的“B树”磁盘表（MyISAM）和索引压缩。</li>
<li>添加另一个存储引擎相对简单。</li>
<li>SQL函数是使用高度优化的类库实现的，运行很快。通常，在完成查询初始化后，不存在存储器分配。</li>
<li>采用Purify（商业内存溢出检测器）以及GPL工具<a href="http://developer.kde.org/~sewardj/">Valgrind</a>测试了MySQL代码。</li>
<li>服务器可作为单独程序运行在客户端/服务器联网环境下</li>
<li>众多列类型： 带符号/无符号整数，1、2、3、4、8字节长，FLOAT，DOUBLE，CHAR，VARCHAR，TEXT，BLOB，DATE，TIME，DATETIME，TIMESTAMP，YEAR，SET，ENUM，以及OpenGIS空间类型。</li>
<li>定长和可变长度记录。</li>
<li>可以将不同数据库的表混合在相同的查询中</li>
<li>十分灵活和安全的权限和密码系统，允许基于主机的验证。连接到服务器时，所有的密码传输均采用加密形式，从而保证了密码安全。</li>
<li>处理大型数据库： 我们使用了MySQL服务器和含5千万条记录的数据库。</li>
<li>在任何平台上，客户端可使用TCP/IP协议连接到MySQL服务器。</li>
<li>对数种不同字符集的全面支持，包括latin1 (cp1252)、german、big5、ujis等。例如，在表名和列名中允许使用斯堪的纳维亚字符‘å’、‘ä’和‘ö’。从MySQL 4.1开始，提供了Unicode支持。</li>
<li>MySQL服务器提供了对SQL语句的内部支持，可用于检查、优化和修复表。通过mysqlcheck客户端，可在命令行上使用这类语句。MySQL还包括myisamchk，这是一种很快的命令行实用工具，可用于在MyISAM表上执行这类操作。</li>
</ul>

<h4>安装布局</h4>

<blockquote>
  <p>bin客户端程序和mysqld服务器</p>
  
  <p>data日志文件，数据库</p>
  
  <p>Docs文档</p>
  
  <p>examples示例程序和脚本</p>
  
  <p>include包含(头)文件</p>
  
  <p>lib库</p>
  
  <p>scripts实用工具脚本</p>
  
  <p>share错误消息文件  </p>
</blockquote>

<h4>MySQL程序</h4>

<blockquote>
  <p>mysqld是MySQL服务器
  mysqld<em>safe、mysql.server和mysqld</em>multi是服务器启动脚本
  mysql<em>install</em>db初始化数据目录和初始数据库
  mysql是一个命令行客户程序，用于交互式或以批处理模式执行SQL语句。
  mysqladmin是用于管理功能的客户程序。
  mysqlcheck执行表维护操作。
  mysqldump和mysqlhotcopy负责数据库备份。
  mysqlimport导入数据文件。
  myisamchk执行表维护操作。
  myisampack产生压缩、只读的表。
  mysqlbinlog是处理二进制日志文件的实用工具。
  perror显示错误代码的含义。</p>
</blockquote>

<h2>连接与断开服务器</h2>

<pre><code>shell&gt; mysql -h host -u user -p
Enter password: ********  
</code></pre>

<p>host和user分别代表MySQL服务器运行的主机名和MySQL账户用户名。 <br />
成功地连接后，可以在mysql>提示下输入QUIT (或\q)随时退出;在Unix中，也可以按control-D键断开服务器。  </p>

<pre><code>mysql&gt; QUIT
Bye  
</code></pre>

<p><strong>连接上服务器并布代表选择了任何数据库</strong>  </p>

<h4>关于如何查询的基本知识</h4>

<p>知道关于如何查询的基本知识，比马上跳至创建表、给他们装载数据并且从他们检索数据更重要。本节描述输入命令的基本原则，使用几个查询，你能尝试了解mysql是如何工作的，<strong>能够以大小写输入关键词,不区分大小写。</strong></p>

<pre><code>mysql&gt; SELECT VERSION(), CURRENT_DATE;
+-----------+--------------+
| VERSION() | CURRENT_DATE |
+-----------+--------------+
| 5.5.30    | 2013-04-10   |
+-----------+--------------+
1 row in set (0.01 sec)
mysql&gt;  
</code></pre>

<ul>
<li>一个命令通常由SQL语句组成，随后跟着一个分号。（有一些例外不需要分号。早先提到的QUIT是一个例子。后面我们将看到其它的例子。）</li>
<li>当发出一个命令时，mysql将它发送给服务器并显示执行结果，然后显示另一个mysql&gt;显示它准备好接受其它命令。</li>
<li>mysql用表格(行和列)方式显示查询输出。第一行包含列的标签，随后的行是查询结果。通常，列标签是你取自数据库表的列的名字。如果你正在检索一个表达式而非表列的值(如刚才的例子)，mysql用表达式本身标记列。</li>
<li>mysql显示返回了多少行，以及查询花了多长时间，它给你提供服务器性能的一个大致概念。因为他们表示时钟时间(不是 CPU 或机器时间)，并且因为他们受到诸如服务器负载和网络延时的影响，因此这些值是不精确的。（为了简洁，在本章其它例子中不再显示“集合中的行”。）  </li>
</ul>

<p><strong>将mysql用作一个简单的计算器</strong></p>

<pre><code>mysql&gt; SELECT SIN(PI()/4), (4+1)*5;
+--------------------+---------+
| SIN(PI()/4)        | (4+1)*5 |
+--------------------+---------+
| 0.7071067811865475 |      25 |
+--------------------+---------+
1 row in set (0.02 sec)

mysql&gt;  
</code></pre>

<p><strong>你可以在一行上输入多条语句，只需要以一个分号间隔开各语句</strong></p>

<pre><code>mysql&gt; SELECT VERSION(); SELECT NOW();
+-----------+
| VERSION() |
+-----------+
| 5.5.30    |
+-----------+
1 row in set (0.00 sec)

+---------------------+
| NOW()               |
+---------------------+
| 2013-04-10 14:03:48 |
+---------------------+
1 row in set (0.00 sec)

mysql&gt;  
</code></pre>

<p><strong>不必全在一个行内给出一个命令，较长命令可以输入到多个行中。mysql通过寻找终止分号而不是输入行的结束来决定语句在哪儿结束。（换句话说，mysql接受自由格式的输入：它收集输入行但直到看见分号才执行。）</strong></p>

<pre><code>mysql&gt; SELECT
    -&gt; USER()
    -&gt; ,
    -&gt; CURRENT_DATE;
+---------------+--------------+
| USER()        | CURRENT_DATE |
+---------------+--------------+
| jon@localhost | 2005-10-11   |
+---------------+--------------+
</code></pre>

<p><strong>取消输入的查询\c</strong>  </p>

<pre><code>mysql&gt; SELECT
    -&gt; USER()
    -&gt; \c
mysql&gt;
</code></pre>

<p>提示符含义</p>

<blockquote>
  <p>mysql>准备好接受新命令。</p>
  
  <p>->等待多行命令的下一行。</p>
  
  <p>'>等待下一行，等待以单引号(“'”)开始的字符串的结束。</p>
  
  <p>">等待下一行，等待以双引号(“"”)开始的字符串的结束。</p>
  
  <p>`>等待下一行，等待以反斜点(‘`’)开始的识别符的结束。</p>
  
  <p>/*>等待下一行，等待以/*开始的注释的结束。  </p>
</blockquote>

<h2>创建并使用数据库</h2>

<h4>Show数据库</h4>

<p>SHOW语句找出服务器上当前存在什么数据库，可能你的机器上的数据库列表是不同的，但是很可能有mysql和test数据库。mysql是必需的，因为它描述用户访问权限，test数据库经常作为用户试身手的工作区。</p>

<pre><code>mysql&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| test               |
+--------------------+
4 rows in set (0.00 sec)
</code></pre>

<h4>找出当前选择了哪个数据库DATABASE( )函数</h4>

<pre><code>mysql&gt; SELECT DATABASE();
+------------+
| DATABASE() |
+------------+
| NULL       |
+------------+
1 row in set (0.00 sec)  
</code></pre>

<h4>Use数据库</h4>

<p>USE，类似QUIT，不需要一个分号。（如果你喜欢，你可以用一个分号终止这样的语句；这无碍）USE语句在使用上也有另外一个特殊的地方：它必须在一个单行上给出</p>

<pre><code>mysql&gt; use test
Database changed
</code></pre>

<h4>CREATE创建数据库</h4>

<pre><code>mysql&gt; CREATE DATABASE menagerie;
</code></pre>

<p><strong>创建数据库并不表示选定并使用它，你必须明确地USE操作。你可以根据上面的例子执行一个USE语句来实现。还可以在调用mysql时，通过命令行选择数据库，只需要在提供连接参数之后指定数据库名称。</strong></p>

<pre><code>shell&gt; mysql -h host -u user -p menagerie
Enter password: ********
</code></pre>

<h4>Show表</h4>

<p>展示所有的表  </p>

<pre><code>mysql&gt; SHOW TABLES;
+---------------------+
| Tables in menagerie |
+---------------------+
| pet                 |
+---------------------+
</code></pre>

<h4>CREATE创建表</h4>

<p>CREATE TABLE语句指定你的数据库表的布局</p>

<pre><code>mysql&gt; CREATE TABLE pet (name VARCHAR(20), owner VARCHAR(20),
    -&gt; species VARCHAR(20), sex CHAR(1), birth DATE, death DATE);
</code></pre>

<h4>DESCRIBE表</h4>

<p>查看表结构(描述)</p>

<pre><code>mysql&gt; DESCRIBE pet;
+---------+-------------+------+-----+---------+-------+
| Field   | Type        | Null | Key | Default | Extra |
+---------+-------------+------+-----+---------+-------+
| name    | varchar(20) | YES  |     | NULL    |       |
| owner   | varchar(20) | YES  |     | NULL    |       |
| species | varchar(20) | YES  |     | NULL    |       |
| sex     | char(1)     | YES  |     | NULL    |       |
| birth   | date        | YES  |     | NULL    |       |
| death   | date        | YES  |     | NULL    |       |
+---------+-------------+------+-----+---------+-------+
</code></pre>

<h4>LOAD DATA 或者 INSERT 插入表数据</h4>

<p>因为你是从一个空表开始的，填充它的一个简易方法是创建一个文本文件，每个动物各一行，然后用一个语句将文件的内容装载到表中。
你可以创建一个文本文件“pet.txt”，每行包含一个记录，用定位符(tab)把值分开，并且以CREATE TABLE语句中列出的列次序给出。对于丢失的值(例如未知的性别，或仍然活着的动物的死亡日期)，你可以使用NULL值。为了在你的文本文件中表示这些内容，使用\N（反斜线，字母N）。</p>

<blockquote>
  <p>Whistler    Gwen    bird    \N  1997-12-09  \N</p>
</blockquote>

<p>请注意如果用Windows中的编辑器（使用\r\n做为行的结束符）创建文件，（在运行OS X的Apple机上，应使用行结束符'\r'。）,如果你愿意，你能明确地在LOAD DATA语句中指出列值的分隔符和行尾标记，但是默认标记是定位符和换行符。这对读入文件“pet.txt”的语句已经足够。应使用：</p>

<pre><code>mysql&gt; LOAD DATA LOCAL INFILE '/path/pet.txt' INTO TABLE pet
    -&gt; LINES TERMINATED BY '\r\n';
</code></pre>

<p>INSERT这里字符串和日期值均为引号扩起来的字符串。另外，可以直接用INSERT语句插入NULL代表不存在的值</p>

<pre><code>mysql&gt; INSERT INTO pet
    -&gt; VALUES ('Puffball','Diane','hamster','f','1999-03-30',NULL);
</code></pre>

<h2>MySQL用户账户管理</h2>

<p>当用命令行客户端连接MySQL服务器时，你应为想要使用的账户指定用户名和密码：</p>

<pre><code>shell&gt; mysql --user=monty --password=guess db_name
</code></pre>

<h4>向MySQL增加新用户账户</h4>

<p>可以用两种方式创建MySQL账户：</p>
<ul>
<li>使用GRANT语句</li>
<li>直接操作MySQL授权表</li>
</ul>

<p>1.首先，使用MySQL程序以MySQL root用户来连接服务器,然后设置帐号和授权：</p>

<pre><code>mysql&gt; GRANT ALL PRIVILEGES ON *.* TO 'monty'@'%'
    -&gt;     IDENTIFIED BY 'some_pass'  IDENTIFIED BY 'some_pass' [WITH with_option];
with_option:
| MAX_QUERIES_PER_HOUR count
| MAX_UPDATES_PER_HOUR count
| MAX_CONNECTIONS_PER_HOUR count
| MAX_USER_CONNECTIONS count
</code></pre>

<p>2.除了GRANT，你可以直接用INSERT语句创建相同的账户，然后使用FLUSH PRIVILEGES告诉服务器重载授权表：
	<pre><code>
    shell> mysql --user=root mysql
    mysql> INSERT INTO user
        ->     VALUES('localhost','monty',PASSWORD('some<em>pass'),
        ->     'Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y');
    mysql> INSERT INTO user
        ->     VALUES('%','monty',PASSWORD('some</em>pass'),
        ->     'Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y');
    mysql> INSERT INTO user SET Host='localhost',User='admin',
        ->     Reload<em>priv='Y', Process</em>priv='Y';
    mysql> INSERT INTO user (Host,User,Password)
        ->     VALUES('localhost','dummy','');
    mysql> FLUSH PRIVILEGES;
    </code></pre>
<strong>FLUSH PRIVILEGES的原因是告诉服务器重读授权表。否则，只有重启服务器后更改方会被注意到。使用 GRANT，则不需要使用FLUSH PRIVILEGES。</strong></p>

<h4>从MySQL删除用户账户</h4>

<p>应使用DROP USER语句</p>

<h4>设置账户密码</h4>

<p>可以用mysqladmin命令在命令行指定密码：</p>

<pre><code>shell&gt; mysqladmin -u user_name -h host_name password "newpwd"
</code></pre>

<p>该命令重设密码的账户为user表内匹配User列的user_name和Host列你发起连接的客户端的记录。</p>

<p>为账户赋予密码的另一种方法是执行SET PASSWORD语句：</p>

<pre><code>mysql&gt; SET PASSWORD FOR 'jeffrey'@'%' = PASSWORD('biscuit');
</code></pre>

<p>只有root等可以更新mysql数据库的用户可以更改其它用户的密码。如果你没有以匿名用户连接，省略FOR子句便可以更改自己的密码：</p>

<pre><code>mysql&gt; SET PASSWORD = PASSWORD('biscuit');
</code></pre>

<p>你还可以在全局级别使用GRANT USAGE语句(在<em>.</em>)来指定某个账户的密码而不影响账户当前的权限：</p>

<pre><code>mysql&gt; GRANT USAGE ON *.* TO 'jeffrey'@'%' IDENTIFIED BY 'biscuit';
</code></pre>
      </article>
      <article id="sql"><h1>Mysql中的SQL</h1>
<h2>SQL(Structrured Query Language)</h2>
<p>用于读写Mysql数据库。SQL是与MYSQL交互所需的最基本的工具。</p>
<h4>SQL的历史</h4>
<p>当Mysql出现时，它为数据库服务器业务带来了新的方法。Monty并没有开发另一个庞大的RDBMS，也没有尝试去提供比数据库巨头们更多的特性。而是为最常用的SQL刚能创建了一个小巧而快速的实现。</p>
<h4>SQL的设计</h4>
<p>SQL是一种"自然"语言，因为它具有简单而明确的命令结构。每个称为“查询”的SQL命令都可以被分割为语言元素。<strong>SQL语句不区分大小写</strong></p>
<blockquote>
<p>select   | name   |  from people  |  where name like '%e'<br>
动词   | 直接宾语  |   间接宾语    |    形容词短语  
</p>
</blockquote>
<h4>表管理</h4>
<h5>Create table</h5>
<pre><code>create table table_name(
    column_name1 type [modifiers]
    [, column_name2 type [modifiers]]
)

create table user(
    user_id bigint unsigned not NULL primary key,
    user_name char(10) not NULL,
    last_name varchar(30),
    office char(2) not NULL default 'NY'
);
</code></pre>

<blockquote>
<p>NOTNULL修饰符表示该列不能包含任何null值，如果试图将null值赋给该列，那么sql 将产生错误，
此规则有两个例外<br>
1.如果该列被定义为auto_increment,则null值会导致一个自动产生的值<br>
2.如果该列指定了默认值，则null值会被赋予默认值  
</p>
</blockquote>
<h4>DROP table</h4>
<p><strong>始终备份并谨慎的删除表</strong>  
</p>
<pre><code>drop table [if exists] table_name1,table_name2;
</code></pre>

<p>if exists在设计用于创建数据库及其所有表的庞大脚本时非常有用。</p>
<h4>INSERT</h4>
<p>当向数值字段插入数据时，可以原样插入，对于其他字段，必须把值放在单引号中。<br>
<strong>转义字符（默认为/）允许将单引号和其他转义字符直接量进行转义</strong>  
</p>
<h4>UPDATE</h4>
<pre><code>update table_name set column1=value1 [where clause]  
</code></pre>

<p><strong>WHERE 子句中的列是要搜索的列，所以一般要围绕经常使用的列的组合来创建索引。</strong>  
</p>
<h4>DELETE</h4>
<pre><code>delete from table_name [where clause]
</code></pre>

<h4>SELECT</h4>
<pre><code>select 1;
select database();
select current_date();
select * from people limit 10;
</code></pre>

<h2>Mysql DataType</h2>
<p>MySQL supports a number of SQL data types in several categories:  
</p>
<blockquote>
<p>numeric types<br>
date and time types<br>
string (character and byte) types.</p>
</blockquote>
<h4>Numeric Type Overview</h4>
<ul>
<li>Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT</li>
<li>Fixed-Point Types (Exact Value) - DECIMAL, NUMERIC</li>
<li>Floating-Point Types (Approximate Value) - FLOAT, DOUBLE</li>
<li>Bit-Value Type - BIT</li>
</ul>
<h4>Date and Time Types</h4>
<ul>
<li>The DATE, DATETIME, and TIMESTAMP Types</li>
<li>The TIME Type</li>
<li>The YEAR Type</li>
</ul>
<h4>String Types</h4>
<ul>
<li>The CHAR and VARCHAR Types</li>
<li>The BINARY and VARBINARY Types</li>
<li>The BLOB and TEXT Types</li>
<li>The ENUM Type</li>
<li>The SET Type</li>
</ul>
<h2>索引</h2>
<p>索引有助于数据库以一种可进行更迅速查找的方式存储数据，遗憾的是，尽管可以更为快速地进行搜索，但在得到这一好处的同时。却要牺牲磁盘空间和修改速度。索引最有效的使用方法是要为那些要频繁查找的列创建索引。</p>
<pre><code>create index index_name on table_name(column1,column2...)
</code></pre>

<p>Mysql也可以在创建表的同时创建索引</p>
<pre><code>create table material(
id int not null,
name char(50) not null,
resistance int,
index index1(id,name),
unique index index2(name)
)
</code></pre>

<p>上面的例子为表创建了两个索引，第一个索引名为index1，由id和那么两个字段组成。第一个索引只包括name字段，指明那么字段必须是惟一的。<strong>一般，应该将所有惟一索引的字段声明为not null</strong>  
</p>
<h2>序列</h2>
<p>最好的一种主键是除了作为主键以外在数据库中没有任何意义。更好的设计原则是使用无意义的数字作为主键。  
</p>
<h4>auto_increment</h4>
<p><strong>在mysql中创建表时，最多可以指定一列作为auto_increment，即最多可用于表中一个整数类型的列。</strong>  
</p>
<blockquote>
<p>该列必须是主键或者惟一索引中仅有的列  
</p>
</blockquote>
<p>这时在插入行时，若指定该行的相应值为null或0，就可以为该列自动完成插入，并置为当前的最高值加1。  
</p>
<h4>LAST<em>INSERT</em>ID()函数</h4>
<p>可以通过引用此函数的返回值并自己完成增加来实现序列。  
</p>
<pre><code>update table_name set id = last_insert_id(id+1);</code></pre></article>
    </div>
    <script src="../../javascripts/scale.fix.js"></script>
    <script src="../../javascripts/jquery-1.8.0.min.js"></script>
    <script src="../../javascripts/bootstrap-scrollspy.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            var $close_contents = $(".close"),
                $show_contents = $(".show-contents"),
                $show_note = $(".show-note-link"),
                $leftNav = $('#leftNav'),
                $contents = $(".contents");
            var UI = (function(){
                var init = function(){
                    $leftNav.scrollspy();
                    initEventsHandler();
                    
                },
                initEventsHandler    = function() {
                    
                    // click close
                    $close_contents.bind("click",hideContents);
                    $show_contents.bind("click",showContents);
                    $show_note.bind("click",showNote);
                    
                },
                hideContents = function(){
                    $contents.removeClass("contents-active");
                },
                showContents = function(){
                    $contents.addClass("contents-active");
                },
                showNote = function(){
                    $show_note.removeClass("active");
                    $(this).addClass("active");
                };
                
                return {init : init};
            })();
            UI.init();
        });
    </script>
    
</body>
</html>
